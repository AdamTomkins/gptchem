Upload progress:   0%|          | 0.00/18.7k [00:00<?, ?it/s]Upload progress: 100%|██████████| 18.7k/18.7k [00:00<00:00, 10.4Mit/s]
2023-01-30 22:40:05.508 | ERROR    | __main__:<module>:135 - Fine tuning failed. Result: {
  "created_at": 1675114109,
  "events": [
    {
      "created_at": 1675114109,
      "level": "info",
      "message": "Created fine-tune: ft-vZ7S0SXLH9xZ9grm1labNWjl",
      "object": "fine-tune-event"
    }
  ],
  "fine_tuned_model": null,
  "hyperparams": {
    "batch_size": null,
    "learning_rate_multiplier": 0.02,
    "n_epochs": 8,
    "prompt_loss_weight": 0.01
  },
  "id": "ft-vZ7S0SXLH9xZ9grm1labNWjl",
  "model": "ada",
  "object": "fine-tune",
  "organization_id": "org-TFRJXw3PPQocOWbu71eI2t9U",
  "result_files": [],
  "status": "pending",
  "training_files": [
    {
      "bytes": 18660,
      "created_at": 1675114109,
      "filename": "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_222828/train.jsonl",
      "id": "file-1RGAmjqodXUS70TrCioqsPN4",
      "object": "file",
      "purpose": "fine-tune",
      "status": "uploaded",
      "status_details": null
    }
  ],
  "updated_at": 1675114109,
  "validation_files": []
}.
Traceback (most recent call last):

> File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 133, in <module>
    train_test_evaluate(TRAIN_SIZE, noise_level, NUM_SAMPLES, TEMPERATURES, seed + 48845)
    │                   │           │            │            │             └ 0
    │                   │           │            │            └ [2.0, 1.5, 1.25, 1.0, 0.75, 0.5, 0.2, 0.1, 0]
    │                   │           │            └ 100
    │                   │           └ 50
    │                   └ 92
    └ <function train_test_evaluate at 0x1009740d0>

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 69, in train_test_evaluate
    tune_res = tuner(formatted_train)
               │     └                                                prompt  ...  representation
               │       0   What is a molecule with E isomer transition wa...
               └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 213, in __call__
    return self.tune(train_df, validation_df)
           │    │    │         └ None
           │    │    └                                                prompt  ...  representation
           │    │      0   What is a molecule with E isomer transition wa...
           │    └ <function Tuner.tune at 0x291de5550>
           └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 200, in tune
    raise ValueError(f"Fine tuning failed. Result: {result}.")

ValueError: Fine tuning failed. Result: {
  "created_at": 1675114109,
  "events": [
    {
      "created_at": 1675114109,
      "level": "info",
      "message": "Created fine-tune: ft-vZ7S0SXLH9xZ9grm1labNWjl",
      "object": "fine-tune-event"
    }
  ],
  "fine_tuned_model": null,
  "hyperparams": {
    "batch_size": null,
    "learning_rate_multiplier": 0.02,
    "n_epochs": 8,
    "prompt_loss_weight": 0.01
  },
  "id": "ft-vZ7S0SXLH9xZ9grm1labNWjl",
  "model": "ada",
  "object": "fine-tune",
  "organization_id": "org-TFRJXw3PPQocOWbu71eI2t9U",
  "result_files": [],
  "status": "pending",
  "training_files": [
    {
      "bytes": 18660,
      "created_at": 1675114109,
      "filename": "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_222828/train.jsonl",
      "id": "file-1RGAmjqodXUS70TrCioqsPN4",
      "object": "file",
      "purpose": "fine-tune",
      "status": "uploaded",
      "status_details": null
    }
  ],
  "updated_at": 1675114109,
  "validation_files": []
}.
Uploaded file from /Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_222828/train.jsonl: file-1RGAmjqodXUS70TrCioqsPN4
Upload progress:   0%|          | 0.00/18.7k [00:00<?, ?it/s]Upload progress: 100%|██████████| 18.7k/18.7k [00:00<00:00, 23.3Mit/s]
2023-01-30 22:42:05.676 | ERROR    | __main__:<module>:135 - Error communicating with OpenAI: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))
Traceback (most recent call last):

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       │    └ <function HTTPConnectionPool._make_request at 0x118969820>
                       └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
    │   └ <function raise_from at 0x11871ee50>
    └ <module 'urllib3.packages.six' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/pac...
  File "<string>", line 3, in raise_from
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       │    └ <function HTTPConnection.getresponse at 0x1183d4280>
                       └ <urllib3.connection.HTTPSConnection object at 0x16fa89460>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/http/client.py", line 1377, in getresponse
    response.begin()
    │        └ <function HTTPResponse.begin at 0x1183d15e0>
    └ <http.client.HTTPResponse object at 0x16fa89e20>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/http/client.py", line 320, in begin
    version, status, reason = self._read_status()
                              │    └ <function HTTPResponse._read_status at 0x1183d1550>
                              └ <http.client.HTTPResponse object at 0x16fa89e20>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/http/client.py", line 281, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               │    │           └ 65536
               │    └ None
               └ <http.client.HTTPResponse object at 0x16fa89e20>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/socket.py", line 704, in readinto
    return self._sock.recv_into(b)
           │    │               └ <memory at 0x291e1fdc0>
           │    └ None
           └ <socket.SocketIO object at 0x16fa89d00>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 1242, in recv_into
    return self.read(nbytes, buffer)
           │    │    │       └ <memory at 0x291e1fdc0>
           │    │    └ 8192
           │    └ <function SSLSocket.read at 0x11846bf70>
           └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 1100, in read
    return self._sslobj.read(len, buffer)
           │    │            │    └ <memory at 0x291e1fdc0>
           │    │            └ 8192
           │    └ None
           └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>

ConnectionResetError: [Errno 54] Connection reset by peer


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/adapters.py", line 489, in send
    resp = conn.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x118969a60>
           └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x118763700>
              └ Retry(total=2, connect=None, read=None, redirect=None, status=None)
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/util/retry.py", line 550, in increment
    raise six.reraise(type(error), error, _stacktrace)
          │   │            │       │      └ <traceback object at 0x16fa8ca00>
          │   │            │       └ ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))
          │   │            └ ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))
          │   └ <function reraise at 0x11871edc0>
          └ <module 'urllib3.packages.six' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/pac...
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/packages/six.py", line 769, in reraise
    raise value.with_traceback(tb)
          │                    └ None
          └ None
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       │    └ <function HTTPConnectionPool._make_request at 0x118969820>
                       └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 449, in _make_request
    six.raise_from(e, None)
    │   └ <function raise_from at 0x11871ee50>
    └ <module 'urllib3.packages.six' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/pac...
  File "<string>", line 3, in raise_from
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 444, in _make_request
    httplib_response = conn.getresponse()
                       │    └ <function HTTPConnection.getresponse at 0x1183d4280>
                       └ <urllib3.connection.HTTPSConnection object at 0x16fa89460>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/http/client.py", line 1377, in getresponse
    response.begin()
    │        └ <function HTTPResponse.begin at 0x1183d15e0>
    └ <http.client.HTTPResponse object at 0x16fa89e20>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/http/client.py", line 320, in begin
    version, status, reason = self._read_status()
                              │    └ <function HTTPResponse._read_status at 0x1183d1550>
                              └ <http.client.HTTPResponse object at 0x16fa89e20>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/http/client.py", line 281, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               │    │           └ 65536
               │    └ None
               └ <http.client.HTTPResponse object at 0x16fa89e20>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/socket.py", line 704, in readinto
    return self._sock.recv_into(b)
           │    │               └ <memory at 0x291e1fdc0>
           │    └ None
           └ <socket.SocketIO object at 0x16fa89d00>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 1242, in recv_into
    return self.read(nbytes, buffer)
           │    │    │       └ <memory at 0x291e1fdc0>
           │    │    └ 8192
           │    └ <function SSLSocket.read at 0x11846bf70>
           └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 1100, in read
    return self._sslobj.read(len, buffer)
           │    │            │    └ <memory at 0x291e1fdc0>
           │    │            └ 8192
           │    └ None
           └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>

urllib3.exceptions.ProtocolError: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_requestor.py", line 498, in request_raw
    result = _thread_context.session.request(
             └ <_thread._local object at 0x291aa1bd0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           │    │    │       └ {'timeout': 600, 'allow_redirects': True, 'proxies': OrderedDict(), 'stream': False, 'verify': True, 'cert': None}
           │    │    └ <PreparedRequest [POST]>
           │    └ <function Session.send at 0x118da5820>
           └ <requests.sessions.Session object at 0x291e62d60>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        │       │    │          └ {'timeout': 600, 'proxies': OrderedDict(), 'stream': False, 'verify': True, 'cert': None}
        │       │    └ <PreparedRequest [POST]>
        │       └ <function HTTPAdapter.send at 0x118da3ca0>
        └ <requests.adapters.HTTPAdapter object at 0x291e628e0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/adapters.py", line 547, in send
    raise ConnectionError(err, request=request)
          │                            └ <PreparedRequest [POST]>
          └ <class 'requests.exceptions.ConnectionError'>

requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

> File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 133, in <module>
    train_test_evaluate(TRAIN_SIZE, noise_level, NUM_SAMPLES, TEMPERATURES, seed + 48845)
    │                   │           │            │            │             └ 0
    │                   │           │            │            └ [2.0, 1.5, 1.25, 1.0, 0.75, 0.5, 0.2, 0.1, 0]
    │                   │           │            └ 100
    │                   │           └ 20
    │                   └ 92
    └ <function train_test_evaluate at 0x1009740d0>

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 69, in train_test_evaluate
    tune_res = tuner(formatted_train)
               │     └                                                prompt  ...  representation
               │       0   What is a molecule with E isomer transition wa...
               └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 213, in __call__
    return self.tune(train_df, validation_df)
           │    │    │         └ None
           │    │    └                                                prompt  ...  representation
           │    │      0   What is a molecule with E isomer transition wa...
           │    └ <function Tuner.tune at 0x291de5550>
           └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 165, in tune
    "training_file": FineTuneCli._get_or_upload(train_file, check_if_file_exists=False)
                     │           │              └ '/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_224005/train....
                     │           └ <classmethod object at 0x291ddcac0>
                     └ <class 'openai.cli.FineTune'>

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/cli.py", line 351, in _get_or_upload
    return cls._maybe_upload_file(
           │   └ <classmethod object at 0x291ddcaf0>
           └ <class 'openai.cli.FineTune'>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/cli.py", line 329, in _maybe_upload_file
    resp = openai.File.create(
           │      │    └ <classmethod object at 0x291d84250>
           │      └ <class 'openai.api_resources.file.File'>
           └ <module 'openai' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/__init__.py'>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_resources/file.py", line 84, in create
    response, _, api_key = requestor.request("post", url, files=files)
                           │         │               │          └ [('purpose', (None, 'fine-tune')), ('file', ('/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photosw...
                           │         │               └ '/files'
                           │         └ <function APIRequestor.request at 0x291d6ea60>
                           └ <openai.api_requestor.APIRequestor object at 0x16fa893a0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_requestor.py", line 216, in request
    result = self.request_raw(
             │    └ <function APIRequestor.request_raw at 0x291d6edc0>
             └ <openai.api_requestor.APIRequestor object at 0x16fa893a0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_requestor.py", line 510, in request_raw
    raise error.APIConnectionError("Error communicating with OpenAI: {}".format(e)) from e
          │     └ <class 'openai.error.APIConnectionError'>
          └ <module 'openai.error' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/error.py'>

openai.error.APIConnectionError: Error communicating with OpenAI: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))
Upload progress:   0%|          | 0.00/18.7k [00:00<?, ?it/s]Upload progress: 100%|██████████| 18.7k/18.7k [00:00<00:00, 10.4Mit/s]
2023-01-30 22:46:00.889 | ERROR    | __main__:<module>:135 - Fine tuning failed. Result: {
  "created_at": 1675114973,
  "events": [
    {
      "created_at": 1675114973,
      "level": "info",
      "message": "Created fine-tune: ft-Zqt6pD3dIA0spaKN0zJTvbwA",
      "object": "fine-tune-event"
    }
  ],
  "fine_tuned_model": null,
  "hyperparams": {
    "batch_size": null,
    "learning_rate_multiplier": 0.02,
    "n_epochs": 8,
    "prompt_loss_weight": 0.01
  },
  "id": "ft-Zqt6pD3dIA0spaKN0zJTvbwA",
  "model": "ada",
  "object": "fine-tune",
  "organization_id": "org-TFRJXw3PPQocOWbu71eI2t9U",
  "result_files": [],
  "status": "pending",
  "training_files": [
    {
      "bytes": 18660,
      "created_at": 1675114970,
      "filename": "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_224205/train.jsonl",
      "id": "file-mWE1NPInHfYLQx68SX3qfaKi",
      "object": "file",
      "purpose": "fine-tune",
      "status": "uploaded",
      "status_details": null
    }
  ],
  "updated_at": 1675114973,
  "validation_files": []
}.
Traceback (most recent call last):

> File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 133, in <module>
    train_test_evaluate(TRAIN_SIZE, noise_level, NUM_SAMPLES, TEMPERATURES, seed + 48845)
    │                   │           │            │            │             └ 0
    │                   │           │            │            └ [2.0, 1.5, 1.25, 1.0, 0.75, 0.5, 0.2, 0.1, 0]
    │                   │           │            └ 100
    │                   │           └ 10
    │                   └ 92
    └ <function train_test_evaluate at 0x1009740d0>

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 69, in train_test_evaluate
    tune_res = tuner(formatted_train)
               │     └                                                prompt  ...  representation
               │       0   What is a molecule with E isomer transition wa...
               └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 213, in __call__
    return self.tune(train_df, validation_df)
           │    │    │         └ None
           │    │    └                                                prompt  ...  representation
           │    │      0   What is a molecule with E isomer transition wa...
           │    └ <function Tuner.tune at 0x291de5550>
           └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 200, in tune
    raise ValueError(f"Fine tuning failed. Result: {result}.")

ValueError: Fine tuning failed. Result: {
  "created_at": 1675114973,
  "events": [
    {
      "created_at": 1675114973,
      "level": "info",
      "message": "Created fine-tune: ft-Zqt6pD3dIA0spaKN0zJTvbwA",
      "object": "fine-tune-event"
    }
  ],
  "fine_tuned_model": null,
  "hyperparams": {
    "batch_size": null,
    "learning_rate_multiplier": 0.02,
    "n_epochs": 8,
    "prompt_loss_weight": 0.01
  },
  "id": "ft-Zqt6pD3dIA0spaKN0zJTvbwA",
  "model": "ada",
  "object": "fine-tune",
  "organization_id": "org-TFRJXw3PPQocOWbu71eI2t9U",
  "result_files": [],
  "status": "pending",
  "training_files": [
    {
      "bytes": 18660,
      "created_at": 1675114970,
      "filename": "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_224205/train.jsonl",
      "id": "file-mWE1NPInHfYLQx68SX3qfaKi",
      "object": "file",
      "purpose": "fine-tune",
      "status": "uploaded",
      "status_details": null
    }
  ],
  "updated_at": 1675114973,
  "validation_files": []
}.
2023-01-30 22:46:39.388 | ERROR    | __main__:<module>:135 - Error communicating with OpenAI: HTTPSConnectionPool(host='api.openai.com', port=443): Max retries exceeded with url: /v1/files/%2FUsers%2Fkevinmaikjablonka%2Fgit%2Fkjappelbaum%2Fgptchem%2Fexperiments%2F05_inverse%2Fphotoswitch%2Fextrapolation%2Fout%2F20230130_224600%2Ftrain.jsonl (Caused by ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')))
Traceback (most recent call last):

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
                       │    └ <function HTTPConnectionPool._make_request at 0x118969820>
                       └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 386, in _make_request
    self._validate_conn(conn)
    │    │              └ <urllib3.connection.HTTPSConnection object at 0x16fc207f0>
    │    └ <function HTTPSConnectionPool._validate_conn at 0x118969d30>
    └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 1042, in _validate_conn
    conn.connect()
    │    └ <function HTTPSConnection.connect at 0x1189425e0>
    └ <urllib3.connection.HTTPSConnection object at 0x16fc207f0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connection.py", line 414, in connect
    self.sock = ssl_wrap_socket(
    │    │      └ <function ssl_wrap_socket at 0x11891b940>
    │    └ None
    └ <urllib3.connection.HTTPSConnection object at 0x16fc207f0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/util/ssl_.py", line 449, in ssl_wrap_socket
    ssl_sock = _ssl_wrap_socket_impl(
               └ <function _ssl_wrap_socket_impl at 0x11891baf0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/util/ssl_.py", line 493, in _ssl_wrap_socket_impl
    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)
           │           │           │                     └ 'api.openai.com'
           │           │           └ <socket.socket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6>
           │           └ <function SSLContext.wrap_socket at 0x1183f2e50>
           └ <ssl.SSLContext object at 0x16fc45f40>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 501, in wrap_socket
    return self.sslsocket_class._create(
           │    │               └ <classmethod object at 0x118466160>
           │    └ <class 'ssl.SSLSocket'>
           └ <ssl.SSLContext object at 0x16fc45f40>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 1041, in _create
    self.do_handshake()
    │    └ <function SSLSocket.do_handshake at 0x11846cd30>
    └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/ssl.py", line 1310, in do_handshake
    self._sslobj.do_handshake()
    │    └ None
    └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>

ConnectionResetError: [Errno 54] Connection reset by peer


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/adapters.py", line 489, in send
    resp = conn.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x118969a60>
           └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 815, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x118969a60>
           └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 815, in urlopen
    return self.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x118969a60>
           └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x118763700>
              └ Retry(total=0, connect=None, read=None, redirect=None, status=None)
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/urllib3/util/retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
          │             │      │    │        │             └ 'unknown'
          │             │      │    │        └ <class 'urllib3.exceptions.ResponseError'>
          │             │      │    └ ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))
          │             │      └ '/v1/files/%2FUsers%2Fkevinmaikjablonka%2Fgit%2Fkjappelbaum%2Fgptchem%2Fexperiments%2F05_inverse%2Fphotoswitch%2Fextrapolatio...
          │             └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x291e62e50>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='api.openai.com', port=443): Max retries exceeded with url: /v1/files/%2FUsers%2Fkevinmaikjablonka%2Fgit%2Fkjappelbaum%2Fgptchem%2Fexperiments%2F05_inverse%2Fphotoswitch%2Fextrapolation%2Fout%2F20230130_224600%2Ftrain.jsonl (Caused by ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')))


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_requestor.py", line 498, in request_raw
    result = _thread_context.session.request(
             └ <_thread._local object at 0x291aa1bd0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
           │    │    │       └ {'timeout': 600, 'allow_redirects': True, 'proxies': OrderedDict(), 'stream': False, 'verify': True, 'cert': None}
           │    │    └ <PreparedRequest [GET]>
           │    └ <function Session.send at 0x118da5820>
           └ <requests.sessions.Session object at 0x291e62d60>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
        │       │    │          └ {'timeout': 600, 'proxies': OrderedDict(), 'stream': False, 'verify': True, 'cert': None}
        │       │    └ <PreparedRequest [GET]>
        │       └ <function HTTPAdapter.send at 0x118da3ca0>
        └ <requests.adapters.HTTPAdapter object at 0x291e628e0>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/requests/adapters.py", line 565, in send
    raise ConnectionError(e, request=request)
          │                          └ <PreparedRequest [GET]>
          └ <class 'requests.exceptions.ConnectionError'>

requests.exceptions.ConnectionError: HTTPSConnectionPool(host='api.openai.com', port=443): Max retries exceeded with url: /v1/files/%2FUsers%2Fkevinmaikjablonka%2Fgit%2Fkjappelbaum%2Fgptchem%2Fexperiments%2F05_inverse%2Fphotoswitch%2Fextrapolation%2Fout%2F20230130_224600%2Ftrain.jsonl (Caused by ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')))


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

> File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 133, in <module>
    train_test_evaluate(TRAIN_SIZE, noise_level, NUM_SAMPLES, TEMPERATURES, seed + 48845)
    │                   │           │            │            │             └ 0
    │                   │           │            │            └ [2.0, 1.5, 1.25, 1.0, 0.75, 0.5, 0.2, 0.1, 0]
    │                   │           │            └ 100
    │                   │           └ 5.0
    │                   └ 92
    └ <function train_test_evaluate at 0x1009740d0>

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/run_experiments.py", line 69, in train_test_evaluate
    tune_res = tuner(formatted_train)
               │     └                                                prompt  ...  representation
               │       0   What is a molecule with E isomer transition wa...
               └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 213, in __call__
    return self.tune(train_df, validation_df)
           │    │    │         └ None
           │    │    └                                                prompt  ...  representation
           │    │      0   What is a molecule with E isomer transition wa...
           │    └ <function Tuner.tune at 0x291de5550>
           └ gptchem.tuner.Tuner(base_model='ada', batch_size=None, n_epochs=8, learning_rate_multiplier=0.02, run_name=None)

  File "/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/src/gptchem/tuner.py", line 165, in tune
    "training_file": FineTuneCli._get_or_upload(train_file, check_if_file_exists=False)
                     │           │              └ '/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_224600/train....
                     │           └ <classmethod object at 0x291ddcac0>
                     └ <class 'openai.cli.FineTune'>

  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/cli.py", line 345, in _get_or_upload
    openai.File.retrieve(file)
    │      │    │        └ '/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_224600/train....
    │      │    └ <classmethod object at 0x291a97310>
    │      └ <class 'openai.api_resources.file.File'>
    └ <module 'openai' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/__init__.py'>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_resources/abstract/api_resource.py", line 20, in retrieve
    instance.refresh(request_id=request_id, request_timeout=request_timeout)
    │        │                  │                           └ None
    │        │                  └ None
    │        └ <function APIResource.refresh at 0x291d72ee0>
    └ <File id=/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_22460...
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_resources/abstract/api_resource.py", line 32, in refresh
    self.request(
    │    └ <function OpenAIObject.request at 0x291d72940>
    └ <File id=/Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_22460...
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/openai_object.py", line 179, in request
    response, stream, api_key = requestor.request(
              │                 │         └ <function APIRequestor.request at 0x291d6ea60>
              │                 └ <openai.api_requestor.APIRequestor object at 0x16fc1c730>
              └ False
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_requestor.py", line 216, in request
    result = self.request_raw(
             │    └ <function APIRequestor.request_raw at 0x291d6edc0>
             └ <openai.api_requestor.APIRequestor object at 0x16fc1c730>
  File "/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/api_requestor.py", line 510, in request_raw
    raise error.APIConnectionError("Error communicating with OpenAI: {}".format(e)) from e
          │     └ <class 'openai.error.APIConnectionError'>
          └ <module 'openai.error' from '/Users/kevinmaikjablonka/miniconda3/envs/gptchem/lib/python3.9/site-packages/openai/error.py'>

openai.error.APIConnectionError: Error communicating with OpenAI: HTTPSConnectionPool(host='api.openai.com', port=443): Max retries exceeded with url: /v1/files/%2FUsers%2Fkevinmaikjablonka%2Fgit%2Fkjappelbaum%2Fgptchem%2Fexperiments%2F05_inverse%2Fphotoswitch%2Fextrapolation%2Fout%2F20230130_224600%2Ftrain.jsonl (Caused by ProtocolError('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')))
Uploaded file from /Users/kevinmaikjablonka/git/kjappelbaum/gptchem/experiments/05_inverse/photoswitch/extrapolation/out/20230130_224205/train.jsonl: file-mWE1NPInHfYLQx68SX3qfaKi
Upload progress:   0%|          | 0.00/18.7k [00:00<?, ?it/s]Upload progress: 100%|██████████| 18.7k/18.7k [00:00<00:00, 22.6Mit/s]
